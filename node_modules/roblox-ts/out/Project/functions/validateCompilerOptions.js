"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateCompilerOptions = void 0;
const byots_1 = __importDefault(require("byots"));
const kleur_1 = __importDefault(require("kleur"));
const path_1 = __importDefault(require("path"));
const constants_1 = require("../../Shared/constants");
const ProjectError_1 = require("../../Shared/errors/ProjectError");
const ENFORCED_OPTIONS = {
    target: byots_1.default.ScriptTarget.ESNext,
    module: byots_1.default.ModuleKind.CommonJS,
    moduleResolution: byots_1.default.ModuleResolutionKind.NodeJs,
    noLib: true,
    strict: true,
    allowSyntheticDefaultImports: true,
};
function y(str) {
    return kleur_1.default.yellow(str);
}
function validateTypeRoots(nodeModulesPath, typeRoots) {
    const typesPath = path_1.default.resolve(nodeModulesPath);
    for (const typeRoot of typeRoots) {
        if (path_1.default.normalize(typeRoot) === typesPath) {
            return true;
        }
    }
    return false;
}
function validateCompilerOptions(opts, nodeModulesPath) {
    const errors = new Array();
    if (opts.noLib !== ENFORCED_OPTIONS.noLib) {
        errors.push(`${y(`"noLib"`)} must be ${y(`true`)}`);
    }
    if (opts.strict !== ENFORCED_OPTIONS.strict) {
        errors.push(`${y(`"strict"`)} must be ${y(`true`)}`);
    }
    if (opts.target !== ENFORCED_OPTIONS.target) {
    }
    if (opts.module !== ENFORCED_OPTIONS.module) {
        errors.push(`${y(`"module"`)} must be ${y(`commonjs`)}`);
    }
    if (opts.moduleResolution !== ENFORCED_OPTIONS.moduleResolution) {
        errors.push(`${y(`"moduleResolution"`)} must be ${y(`"Node"`)}`);
    }
    if (opts.allowSyntheticDefaultImports !== ENFORCED_OPTIONS.allowSyntheticDefaultImports) {
        errors.push(`${y(`"allowSyntheticDefaultImports"`)} must be ${y(`true`)}`);
    }
    const rbxtsModules = path_1.default.join(nodeModulesPath, constants_1.RBXTS_SCOPE);
    if (opts.typeRoots === undefined || !validateTypeRoots(rbxtsModules, opts.typeRoots)) {
        errors.push(`${y(`"typeRoots"`)} must contain ${y(rbxtsModules)}`);
    }
    if (opts.rootDir === undefined && opts.rootDirs === undefined) {
        errors.push(`${y(`"rootDir"`)} or ${y(`"rootDirs"`)} must be defined`);
    }
    if (opts.outDir === undefined) {
        errors.push(`${y(`"outDir"`)} must be defined`);
    }
    if (opts.jsx !== undefined && opts.jsx !== byots_1.default.JsxEmit.React) {
        errors.push(`${y(`"jsx"`)} must be ${y(`"react"`)} or not defined`);
    }
    if (opts.jsxFactory !== undefined && opts.jsxFactory !== "Roact.createElement") {
        errors.push(`${y(`"jsxFactory"`)} must be ${y(`"Roact.createElement"`)} or not defined`);
    }
    if (errors.length > 0) {
        throw new ProjectError_1.ProjectError([
            `Invalid "tsconfig.json" configuration!`,
            `https://roblox-ts.com/docs/quick-start#project-folder-setup`,
            errors.map(e => `- ${e}\n`).join(""),
        ].join("\n"));
    }
}
exports.validateCompilerOptions = validateCompilerOptions;
//# sourceMappingURL=validateCompilerOptions.js.map